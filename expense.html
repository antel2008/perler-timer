<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´¹ç”¨ç®¡ç† - æ‹¼è±†è®¡æ—¶å™¨ Pro V1.0</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æ‹¼è±†è®¡æ—¶å™¨">
    <meta name="mobile-web-app-capable" content="yes">
    <style>
        @media (max-width: 768px) {
            .expense-page {
                padding: 15px 12px 90px 12px !important;
            }
            
            .page-header {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
                margin-bottom: 20px;
            }
            
            .header-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .header-actions .btn {
                width: 100%;
            }
            
            .expense-stats-compact {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin-bottom: 20px;
            }
            
            .stat-card.compact {
                padding: 12px;
            }
            
            .stat-card.compact .stat-label {
                font-size: 0.85rem;
            }
            
            .stat-card.compact .stat-value {
                font-size: 1.1rem;
            }
            
            .filter-section-compact {
                flex-direction: column;
                gap: 10px;
                margin-bottom: 15px;
            }
            
            .filter-section-compact .filter-group {
                flex-direction: column;
                align-items: stretch;
                gap: 5px;
            }
            
            .filter-section-compact .filter-group label {
                font-size: 0.9rem;
            }
            
            .filter-section-compact .filter-group select,
            .filter-section-compact .filter-group input {
                width: 100%;
                font-size: 16px;
                padding: 10px;
            }
            
            .expense-card.compact {
                padding: 12px;
                margin-bottom: 10px;
            }
            
            .expense-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
            }
            
            .expense-type {
                font-size: 0.85rem;
                padding: 4px 8px;
            }
            
            .expense-amount {
                font-size: 1.1rem;
                font-weight: 600;
            }
            
            .expense-date {
                font-size: 0.85rem;
                color: #7f8c8d;
                margin-bottom: 6px;
            }
            
            .expense-note {
                font-size: 0.85rem;
                margin-bottom: 8px;
            }
            
            .expense-bead-summary {
                display: flex;
                flex-wrap: wrap;
                gap: 6px;
                margin-bottom: 8px;
                font-size: 0.85rem;
            }
            
            .expense-bead-summary .bead-tag {
                padding: 3px 8px;
                font-size: 0.75rem;
                border-radius: 12px;
            }
            
            .expense-actions {
                display: flex;
                justify-content: flex-end;
            }
            
            .modal-content {
                max-width: 95% !important;
                margin: 10px;
                max-height: 90vh;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .modal-content h2 {
                font-size: 1.3rem;
            }
            
            .form-group label {
                font-size: 0.9rem;
            }
            
            .form-group input,
            .form-group textarea,
            .form-group select {
                font-size: 16px;
                padding: 12px;
            }
            
            .expense-bead-list {
                max-height: 200px;
                overflow-y: auto;
            }
            
            .expense-bead-item {
                flex-direction: row;
                padding: 8px;
                margin-bottom: 8px;
            }
            
            .expense-bead-color {
                width: 40px;
                height: 40px;
                font-size: 0.7rem;
                border-radius: 8px;
            }
            
            .expense-bead-info {
                flex: 1;
                padding: 0 10px;
            }
            
            .expense-bead-name {
                font-size: 0.9rem;
                font-weight: 500;
            }
            
            .expense-bead-amount {
                font-size: 0.85rem;
                color: #7f8c8d;
            }
            
            .expense-bead-note {
                font-size: 0.8rem;
                color: #95a5a6;
            }
            
            .modal-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .modal-actions .btn {
                width: 100%;
            }
            
            .empty-hint {
                padding: 30px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <nav class="sidebar">
            <a href="index.html" class="logo">
                <h2 id="shopNameDisplay">æ‹¼è±†è®¡æ—¶å™¨</h2>
                <span class="version">V1.0</span>
            </a>
            
            <div class="nav-menu">
                <a href="timer.html" class="nav-item">
                    <span class="icon">â±ï¸</span>
                    <span>è®¡æ—¶ç®¡ç†</span>
                </a>
                <a href="inventory.html" class="nav-item">
                    <span class="icon">ğŸ“¦</span>
                    <span>åº“å­˜ç®¡ç†</span>
                </a>
                <a href="expense.html" class="nav-item active">
                    <span class="icon">ğŸ’°</span>
                    <span>è´¹ç”¨ç®¡ç†</span>
                </a>
                <a href="settlement.html" class="nav-item">
                    <span class="icon">ğŸ“Š</span>
                    <span>ç»“ç®—ç»Ÿè®¡</span>
                </a>
                <a href="settings.html" class="nav-item">
                    <span class="icon">âš™ï¸</span>
                    <span>ç³»ç»Ÿè®¾ç½®</span>
                </a>
            </div>
        </nav>
        
        <main class="main-content">
            <div class="expense-page">
                <div class="page-header">
                    <h1>ğŸ’° è´¹ç”¨ç®¡ç†</h1>
                    <div class="header-actions">
                        <button onclick="openAddExpenseModal()" class="btn btn-success">â• æ·»åŠ è´¹ç”¨</button>
                        <button onclick="exportExpenses()" class="btn btn-secondary">ğŸ“¤ å¯¼å‡ºæŠ¥è¡¨</button>
                    </div>
                </div>
                
                <!-- è´¹ç”¨ç»Ÿè®¡å¡ç‰‡ï¼ˆç´§å‡‘ç‰ˆï¼‰ -->
                <div class="expense-stats-compact">
                    <div class="stat-card compact">
                        <div class="stat-label">ä»Šæ—¥æ”¯å‡º</div>
                        <div class="stat-value" id="todayExpense">Â¥0.00</div>
                    </div>
                    <div class="stat-card compact">
                        <div class="stat-label">æœ¬æœˆæ”¯å‡º</div>
                        <div class="stat-value" id="monthExpense">Â¥0.00</div>
                    </div>
                    <div class="stat-card compact">
                        <div class="stat-label">æ€»æ”¯å‡º</div>
                        <div class="stat-value" id="totalExpense">Â¥0.00</div>
                    </div>
                    <div class="stat-card compact">
                        <div class="stat-label">å‡€åˆ©æ¶¦</div>
                        <div class="stat-value" id="netProfit">Â¥0.00</div>
                    </div>
                </div>
                
                <!-- ç­›é€‰åŒºï¼ˆç´§å‡‘ç‰ˆï¼‰ -->
                <div class="filter-section-compact">
                    <div class="filter-group">
                        <label>ç±»å‹ï¼š</label>
                        <select id="expenseTypeFilter" class="form-control compact" onchange="loadExpenses()">
                            <option value="all">å…¨éƒ¨</option>
                            <option value="rent">æˆ¿ç§Ÿ</option>
                            <option value="purchase">è¿›è´§</option>
                            <option value="utilities">æ°´ç”µ</option>
                            <option value="salary">äººå·¥</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>æœˆä»½ï¼š</label>
                        <input type="month" id="expenseMonthFilter" class="form-control compact" onchange="loadExpenses()">
                    </div>
                </div>
                
                <!-- è´¹ç”¨åˆ—è¡¨ -->
                <div id="expenseList" class="expense-list-compact"></div>
            </div>
        </main>
    </div>
    
    <!-- æ·»åŠ è´¹ç”¨å¼¹çª— -->
    <div id="addExpenseModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h2>â• æ·»åŠ è´¹ç”¨</h2>
            <div class="form-group">
                <label>è´¹ç”¨ç±»å‹</label>
                <select id="expenseType" class="form-control" onchange="toggleExpenseBeadSection()">
                    <option value="rent">æˆ¿ç§Ÿ</option>
                    <option value="purchase">è¿›è´§</option>
                    <option value="utilities">æ°´ç”µ</option>
                    <option value="salary">äººå·¥</option>
                    <option value="other">å…¶ä»–</option>
                </select>
            </div>
            <div class="form-group">
                <label>é‡‘é¢ï¼ˆå…ƒï¼‰</label>
                <input type="number" id="expenseAmount" class="form-control" step="0.01" min="0" placeholder="è¯·è¾“å…¥é‡‘é¢">
            </div>
            <div class="form-group">
                <label>æ—¥æœŸ</label>
                <input type="date" id="expenseDate" class="form-control">
            </div>
            <div class="form-group">
                <label>å¤‡æ³¨</label>
                <textarea id="expenseNote" class="form-control" placeholder="å¤‡æ³¨ä¿¡æ¯..."></textarea>
            </div>
            
            <div id="expenseBeadSection" style="display: none;">
                <hr>
                <div class="form-group">
                    <label>ğŸ¨ å…³è”æ‹¼è±†åº“å­˜</label>
                    <div id="expenseBeadList" class="expense-bead-list"></div>
                    <button onclick="addExpenseBeadItem()" class="btn btn-sm btn-success" style="margin-top: 10px;">â• æ·»åŠ æ‹¼è±†</button>
>
                </div>
            </div>
            
            <div class="modal-actions">
                <button onclick="closeAddExpenseModal()" class="btn btn-secondary">å–æ¶ˆ</button>
                <button onclick="confirmAddExpense()" class="btn btn-success">ç¡®è®¤æ·»åŠ </button>
            </div>
        </div>
    </div>
    
    <!-- è´¹ç”¨æ‹¼è±†é¡¹å¼¹çª— -->
    <div id="expenseBeadItemModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h2>ğŸ¨ æ·»åŠ æ‹¼è±†</h2>
            <div class="form-group">
                <label>é€‰æ‹©è‰²å·</label>
                <select id="expenseBeadColorSelect" class="form-control">
                    <option value="">è¯·é€‰æ‹©è‰²å·...</option>
                </select>
            </div>
            <div class="form-group">
                <label>æ•°é‡ï¼ˆå…‹ï¼‰</label>
                <input type="number" id="expenseBeadAmount" class="form-control" step="1" min="1" placeholder="ä¾‹å¦‚ï¼š500">
            </div>
            <div class="form-group">
                <label>å¤‡æ³¨</label>
                <input type="text" id="expenseBeadNote" class="form-control" placeholder="å¤‡æ³¨ä¿¡æ¯...">
            </div>
            <div class="modal-actions">
                <button onclick="closeExpenseBeadItemModal()" class="btn btn-secondary">å–æ¶ˆ</button>
                <button onclick="confirmAddExpenseBeadItem()" class="btn btn-success">ç¡®è®¤æ·»åŠ </button>
            </div>
        </div>
    </div>
    
    <script src="bead-data.js"></script>
    <script src="common.js"></script>
    <script>
        // å½“å‰è´¹ç”¨æ‹¼è±†è®°å½•
        let currentExpenseBeads = [];
        
        // åˆå§‹åŒ–é¡µé¢
        function initExpensePage() {
            loadConfig();
            updateShopNameDisplay();
            loadExpenses();
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸ
            document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
        }
        
        // åˆ‡æ¢è´¹ç”¨æ‹¼è±†åŒºåŸŸæ˜¾ç¤º
        function toggleExpenseBeadSection() {
            const type = document.getElementById('expenseType').value;
            const section = document.getElementById('expenseBeadSection');
            
            if (type === 'purchase') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }
        
        // åŠ è½½è´¹ç”¨æ‹¼è±†è‰²å·é€‰æ‹©å™¨
        function loadExpenseBeadColorSelect() {
            const beads = JSON.parse(localStorage.getItem('perlerTimerBeads')) || [];
            const select = document.getElementById('expenseBeadColorSelect');
            
            if (beads.length === 0) {
                const defaultBeads = [...mard221Colors].map(c => ({
                    code: c.code,
                    name: c.name,
                    color: c.color,
                    stock: 0,
                    stockGram: 0
                }));
                localStorage.setItem('perlerTimerBeads', JSON.stringify(defaultBeads));
                loadExpenseBeadColorSelect();
                return;
            }
            
            select.innerHTML = '<option value="">è¯·é€‰æ‹©è‰²å·...</option>';
            beads.forEach(bead => {
                const option = document.createElement('option');
                option.value = bead.code;
                option.textContent = `${bead.code} - ${bead.name}`;
                option.style.color = bead.color;
                select.appendChild(option);
            });
        }
        
        // æ‰“å¼€è´¹ç”¨æ‹¼è±†é¡¹å¼¹çª—
        function openExpenseBeadItemModal() {
            loadExpenseBeadColorSelect();
            document.getElementById('expenseBeadColorSelect').value = '';
            document.getElementById('expenseBeadAmount').value = '';
            document.getElementById('expenseBeadNote').value = '';
            document.getElementById('expenseBeadItemModal').style.display = 'flex';
        }
        
        // å…³é—­è´¹ç”¨æ‹¼è±†é¡¹å¼¹çª—
        function closeExpenseBeadItemModal() {
            document.getElementById('expenseBeadItemModal').style.display = 'none';
        }
        
        // ç¡®è®¤æ·»åŠ è´¹ç”¨æ‹¼è±†é¡¹
        function confirmAddExpenseBeadItem() {
            const colorCode = document.getElementById('expenseBeadColorSelect').value;
            const amount = parseInt(document.getElementById('expenseBeadAmount').value) || 0;
            const note = document.getElementById('expenseBeadNote').value;
            
            if (!colorCode) {
                alert('è¯·é€‰æ‹©è‰²å·ï¼');
                return;
            }
            
            if (amount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°é‡ï¼');
                return;
            }
            
            const beads = JSON.parse(localStorage.getItem('perlerTimerBeads')) || [];
            const bead = beads.find(b => b.code === colorCode);
            
            if (!bead) {
                alert('è‰²å·ä¸å­˜åœ¨ï¼');
                return;
            }
            
            currentExpenseBeads.push({
                code: bead.code,
                name: bead.name,
                color: bead.color,
                amount: amount,
                note: note
            });
            
            updateExpenseBeadList();
            closeExpenseBeadItemModal();
        }
        
        // åˆ é™¤è´¹ç”¨æ‹¼è±†é¡¹
        function removeExpenseBeadItem(index) {
            currentExpenseBeads.splice(index, 1);
            updateExpenseBeadList();
        }
        
        // æ›´æ–°è´¹ç”¨æ‹¼è±†åˆ—è¡¨æ˜¾ç¤º
        function updateExpenseBeadList() {
            const container = document.getElementById('expenseBeadList');
            
            if (currentExpenseBeads.length === 0) {
                container.innerHTML = '<div class="empty-hint">æš‚æ— æ‹¼è±†è®°å½•</div>';
                return;
            }
            
            container.innerHTML = currentExpenseBeads.map((item, index) => `
                <div class="expense-bead-item">
                    <div class="expense-bead-color" style="background-color: ${item.color};">
                        ${item.code}
                    </div>
                    <div class="expense-bead-info">
                        <div class="expense-bead-name">${item.name}</div>
                        <div class="expense-bead-amount">${item.amount}g</div>
                        ${item.note ? `<div class="expense-bead-note">${item.note}</div>` : ''}
                    </div>
                    <button onclick="removeExpenseBeadItem(${index})" class="btn btn-sm btn-danger">åˆ é™¤</button>
                </div>
            `).join('');
        }
        
        // æ·»åŠ è´¹ç”¨æ‹¼è±†é¡¹ï¼ˆæŒ‰é’®è°ƒç”¨ï¼‰
        function addExpenseBeadItem() {
            openExpenseBeadItemModal();
        }
        
        // åŠ è½½è´¹ç”¨åˆ—è¡¨
        function loadExpenses() {
            const typeFilter = document.getElementById('expenseTypeFilter').value;
            const monthFilter = document.getElementById('expenseMonthFilter').value;
            const container = document.getElementById('expenseList');
            
            let expenses = JSON.parse(localStorage.getItem('perlerTimerExpenses') || '[]');
            
            // æŒ‰ç±»å‹ç­›é€‰
            if (typeFilter !== 'all') {
                expenses = expenses.filter(e => e.type === typeFilter);
            }
            
            // æŒ‰æœˆä»½ç­›é€‰
            if (monthFilter) {
                expenses = expenses.filter(e => e.date.startsWith(monthFilter));
            }
            
            // æŒ‰æ—¥æœŸå€’åºæ’åˆ—
            expenses.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (expenses.length === 0) {
                container.innerHTML = '<div class="empty-hint">æš‚æ— è´¹ç”¨è®°å½•</div>';
                updateExpenseStats([]);
                return;
            }
            
            container.innerHTML = expenses.map(expense => `
                <div class="expense-card compact">
                    <div class="expense-header">
                        <span class="expense-type ${expense.type}">${getTypeName(expense.type)}</span>
                        <span class="expense-amount">-Â¥${expense.amount.toFixed(2)}</span>
                    </div>
                    <div class="expense-date">${expense.date}</div>
                    ${expense.note ? `<div class="expense-note">${expense.note}</div>` : ''}
                    ${expense.beads && expense.beads.length > 0 ? `
                        <div class="expense-bead-summary">
                            <span>ğŸ¨ å…³è”æ‹¼è±†ï¼š</span>
                            ${expense.beads.map(b => `<span class="bead-tag" style="background-color: ${b.color};">${b.code} ${b.amount}g</span>`).join('')}
                        </div>
                    ` : ''}
                    <div class="expense-actions">
                        <button onclick="deleteExpense('${expense.id}')" class="btn btn-sm btn-danger">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
            
            updateExpenseStats(expenses);
        }
        
        // æ›´æ–°è´¹ç”¨ç»Ÿè®¡
        function updateExpenseStats(expenses) {
            const today = new Date().toISOString().split('T')[0];
            const currentMonth = today.substring(0, 7);
            
            const allExpenses = JSON.parse(localStorage.getItem('perlerTimerExpenses') || '[]');
            const orders = JSON.parse(localStorage.getItem('perlerTimerOrders') || '[]');
            
            const todayExpenses = allExpenses.filter(e => e.date === today);
            const monthExpenses = allExpenses.filter(e => e.date.startsWith(currentMonth));
            
            const todayIncome = orders.filter(o => o.date === today).reduce((sum, o) => sum + o.actualPayment, 0);
            const totalIncome = orders.reduce((sum, o) => sum + o.actualPayment, 0);
            
            const todayExpense = todayExpenses.reduce((sum, e) => sum + e.amount, 0);
            const monthExpense = monthExpenses.reduce((sum, e) => sum + e.amount, 0);
            const totalExpense = allExpenses.reduce((sum, e) => sum + e.amount, 0);
            const netProfit = totalIncome - totalExpense;
            
            document.getElementById('todayExpense').textContent = `Â¥${todayExpense.toFixed(2)}`;
            document.getElementById('monthExpense').textContent = `Â¥${monthExpense.toFixed(2)}`;
            document.getElementById('totalExpense').textContent = `Â¥${totalExpense.toFixed(2)}`;
            
            const profitEl = document.getElementById('netProfit');
            profitEl.textContent = `Â¥${netProfit.toFixed(2)}`;
            profitEl.className = 'stat-value ' + (netProfit >= 0 ? 'profit' : 'loss');
        }
        
        // æ‰“å¼€æ·»åŠ è´¹ç”¨å¼¹çª—
        function openAddExpenseModal() {
            document.getElementById('expenseType').value = 'other';
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('expenseNote').value = '';
            currentExpenseBeads = [];
            updateExpenseBeadList();
            document.getElementById('addExpenseModal').style.display = 'flex';
        }
        
        // å…³é—­æ·»åŠ è´¹ç”¨å¼¹çª—
        function closeAddExpenseModal() {
            document.getElementById('addExpenseModal').style.display = 'none';
            currentExpenseBeads = [];
        }
        
        // ç¡®è®¤æ·»åŠ è´¹ç”¨
        function confirmAddExpense() {
            const type = document.getElementById('expenseType').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value) || 0;
            const date = document.getElementById('expenseDate').value;
            const note = document.getElementById('expenseNote').value;
            
            if (amount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢ï¼');
                return;
            }
            
            if (!date) {
                alert('è¯·é€‰æ‹©é€‰æ‹©æ—¥æœŸï¼');
                return;
            }
            
            // å¤„ç†æ‹¼è±†åº“å­˜æ›´æ–°ï¼ˆä»…è¿›è´§ç±»å‹ï¼‰
            if (type === 'purchase' && currentExpenseBeads.length > 0) {
                const beads = JSON.parse(localStorage.getItem('perlerTimerBeads')) || [];
                
                currentExpenseBeads.forEach(usage => {
                    const beadIndex = beads.findIndex(b => b.code === usage.code);
                    if (beadIndex !== -1) {
                        beads[beadIndex].stockGram += usage.amount;
                    }
                });
                
                localStorage.setItem('perlerTimerBeads', JSON.stringify(beads));
                
                // è®°å½•åº“å­˜æ“ä½œæ—¥å¿—
                const logs = JSON.parse(localStorage.getItem('perlerTimerInventoryLogs')) || [];
                logs.unshift({
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    type: 'in',
                    colors: currentExpenseBeads.map(u => ({
                        code: u.code,
                        name: u.name,
                        gram: u.amount
                    })),
                    note: `è¿›è´§è´¹ç”¨è®°å½•`,
                    expenseId: generateId()
                });
                localStorage.setItem('perlerTimerInventoryLogs', JSON.stringify(logs.slice(0, 500)));
            }
            
            const expenses = JSON.parse(localStorage.getItem('perlerTimerExpenses') || '[]');
            expenses.unshift({
                id: generateId(),
                type: type,
                amount: amount,
                date: date,
                note: note,
                beads: currentExpenseBeads,
                createTime: new Date().toISOString()
            });
            
            localStorage.setItem('perlerTimerExpenses', JSON.stringify(expenses));
            
            closeAddExpenseModal();
            loadExpenses();
            showNotification('è´¹ç”¨å·²æ·»åŠ ');
        }
        
        // åˆ é™¤è´¹ç”¨
        function deleteExpense(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è´¹ç”¨è®°å½•å—ï¼Ÿ')) {
                const expenses = JSON.parse(localStorage.getItem('perlerTimerExpenses') || '[]');
                const filteredExpenses = expenses.filter(e => e.id !== id);
                localStorage.setItem('perlerTimerExpenses', JSON.stringify(filteredExpenses));
                
                loadExpenses();
                showNotification('è´¹ç”¨å·²åˆ é™¤');
            }
        }
        
        // å¯¼å‡ºè´¹ç”¨æŠ¥è¡¨
        function exportExpenses() {
            const expenses = JSON.parse(localStorage.getItem('perlerTimerExpenses') || '[]');
            
            if (expenses.length === 0) {
                alert('æš‚æ— è´¹ç”¨è®°å½•å¯å¯¼å‡ºï¼');
                return;
            }
            
            let csv = 'æ—¥æœŸ,ç±»å‹,é‡‘é¢,å¤‡æ³¨\n';
            expenses.forEach(e => {
                csv += `${e.date},${getTypeName(e.type)},${e.amount},"${e.note || ''}"\n`;
            });
            
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `è´¹ç”¨æŠ¥è¡¨_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            URL.revokeObjectURL(url);
            
            showNotification('è´¹ç”¨æŠ¥è¡¨å·²å¯¼å‡º');
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', initExpensePage);
    </script>
</body>
</html>
